#include <input/processors.dtsi>
#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/pointing.h>

#define MOUSE 4
#define SCROLL 5
#define NUM 2

&mt {
    flavor = "balanced";
    quick-tap-ms = <0>;
};

&mkp_input_listener { input-processors = <&zip_temp_layer 4 10000>; };

&lt { quick-tap-ms = <0>; };

/ {
    combos {
        compatible = "zmk,combos";

        backspace {
            bindings = <&kp BACKSPACE>;
            key-positions = <8 9>;
        };

        delete {
            bindings = <&kp DELETE>;
            key-positions = <9 8 7>;
        };

        tab {
            bindings = <&kp TAB>;
            key-positions = <0 1>;
        };

        shift_tab {
            bindings = <&kp LS(TAB)>;
            key-positions = <0 1 2>;
        };

        esc {
            bindings = <&kp ESCAPE>;
            key-positions = <10 0>;
        };

        scroll {
            bindings = <&mo 5>;
            key-positions = <27 35>;
        };

        kakuninnnyou {
            bindings = <&trans>;
            key-positions = <30 29 16 17 18 20>;
        };

        shift {
            bindings = <&kp LEFT_SHIFT>;
            key-positions = <20 21>;
        };

        double_quatation {
            bindings = <&kp SQT>;
            key-positions = <19 18>;
        };
    };

    macros {
        GUID: GUID {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp S &kp H &kp U &kp N &kp DOT &kp S &kp DOT &kp O &kp K &kp U &kp N &kp O &kp LEFT_BRACKET &kp P &kp W &kp C &kp DOT &kp C &kp O &kp M>;
            label = "GUID";
        };

        pcpass: pwcpass {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp LS(I) &kp L &kp I &kp V &kp E &kp I &kp N &kp LS(J) &kp U &kp N &kp E &kp N2 &kp N4 &kp N1 &kp N9 &kp N8 &kp N7 &kp EXCL>;
            label = "PWCPASS";
        };

        macpass: macpass {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp A &kp L &kp T &kp E &kp R &kp N &kp A &kp T &kp I &kp V &kp E>;
            label = "MACPASS";
        };

        onepassword: onepassword {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp LS(I) &kp L &kp I &kp V &kp E &kp I &kp N &kp LS(J) &kp A &kp P &kp A &kp N &kp N7 &kp EXCL>;
            label = "ONEPASSWORD";
        };

        toMacStudio: toMacStudio {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&none>;
            label = "TOMACSTUDIO";
        };

        toiPad13: toiPad13 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&none>;
            label = "TOIPAD13";
        };

        toiPad11: toiPad11 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&none>;
            label = "TOIPAD11";
        };

        toiPhone: toiPhone {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&none>;
            label = "TOIPHONE";
        };

        JRAticketSmartsheet2: JTAticketSmartsheet {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp TAB &kp LEFT_SHIFT &kp ENTER &kp TAB &kp TAB &kp ENTER>;
            label = "JTATICKETSMARTSHEET";
        };

        JRAticketSmartsheet1: JRAticketSmartsheet1 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp TAB &kp LEFT_SHIFT &kp ENTER &kp TAB &kp ENTER>;
            label = "JRATICKETSMARTSHEET1";
        };
    };

    behaviors {
        right_click: right_click_behavior {
            compatible = "zmk,behavior-mouse-key";
            label = "RIGHT_CLICK";
            #binding-cells = <0>;

            // 右クリックは通常 MB2 に対応（ZMKの標準定義）

            bindings = <&mkp MB2>;
        };
    };

    keymap {
        compatible = "zmk,keymap";

        WIN_default_layer {
            bindings = <
&kp Q             &kp W         &kp E         &kp R                           &kp T                       &kp Y          &kp U                            &kp I      &kp O        &kp P
&kp A             &kp S         &kp D         &kp F                           &kp G                       &kp H          &kp J                            &kp K      &kp L        &kp ENTER
&mt LEFT_SHIFT Z  &kp X         &kp C         &kp V                           &kp B                       &kp N          &kp M                            &kp COMMA  &kp PERIOD   &mt RIGHT_SHIFT MINUS
&kp LEFT_CONTROL  &kp LEFT_GUI  &kp LEFT_ALT  &mt LEFT_SHIFT INTERNATIONAL_5  &lt 3 SPACE  &lt 2 ENTER    &kp BACKSPACE  &mt RIGHT_SHIFT INTERNATIONAL_4             &lt 7 SLASH  &mt LEFT_CONTROL LEFT_BRACKET
            >;

            sensor-bindings = <&inc_dec_kp PG_UP PAGE_DOWN>;
        };

        MacDefault {
            bindings = <
&kp Q             &kp W             &kp E         &kp R                      &kp T                       &kp Y          &kp U                       &kp I      &kp O        &kp P
&kp A             &kp S             &kp D         &kp F                      &kp G                       &kp H          &kp J                       &kp K      &kp L        &kp ENTER
&mt LEFT_SHIFT Z  &kp X             &kp C         &kp V                      &kp B                       &kp N          &kp M                       &kp COMMA  &kp PERIOD   &mt RIGHT_SHIFT MINUS
&kp LEFT_GUI      &kp LEFT_CONTROL  &kp LEFT_ALT  &mt LEFT_SHIFT LANGUAGE_2  &lt 8 SPACE  &lt 2 ENTER    &kp BACKSPACE  &mt RIGHT_SHIFT LANGUAGE_1             &lt 7 SLASH  &mt LEFT_COMMAND AT_SIGN
            >;

            sensor-bindings = <&inc_dec_kp PG_UP PAGE_DOWN>;
        };

        NUM {
            bindings = <
&kp EQUAL              &kp N7        &kp N8        &kp N9        &kp LS(APOS)                 &kp DOT      &kp ASTRK  &kp N7        &kp N8        &kp N9
&kp LEFT_PARENTHESIS   &kp NUMBER_4  &kp N5        &kp NUMBER_6  &kp MINUS                    &kp SLASH    &kp MINUS  &kp NUMBER_4  &kp N5        &kp NUMBER_6
&kp RIGHT_PARENTHESIS  &kp NUMBER_1  &kp NUMBER_2  &kp NUMBER_3  &kp LS(SEMICOLON)            &kp EQUAL    &kp PLUS   &kp NUMBER_1  &kp NUMBER_2  &kp NUMBER_3
&trans                 &kp N0        &kp SLASH     &trans        &lt 6 SPACE        &trans    &lt 6 SPACE  &trans                   &kp N0        &kp EQUAL
            >;
        };

        ARROW {
            bindings = <
&kp LS(NUMBER_1)    &kp LS(NUMBER_2)    &kp LS(NUMBER_3)     &kp LS(NUMBER_4)     &kp LS(N5)                 &kp LS(NUMBER_6)       &kp LS(N7)             &kp LS(N8)        &kp LS(N9)         &kp LS(N0)
&trans              &kp LA(LEFT_ARROW)  &kp UP_ARROW         &kp LA(RIGHT_ARROW)  &GUID                      &kp MINUS              &kp EQUAL              &kp LEFT_BRACKET  &kp RIGHT_BRACKET  &kp BACKSLASH
&kp LEFT_SHIFT      &kp LEFT_ARROW      &kp DOWN_ARROW       &kp RIGHT_ARROW      &pcpass                    &kp LS(MINUS)          &kp LS(EQUAL)          &kp LEFT_BRACE    &kp RIGHT_BRACE    &kp LS(BACKSLASH)
&kp LG(LEFT_ARROW)  &kp LG(UP_ARROW)    &kp LG(RIGHT_ARROW)  &kp LG(DOWN_ARROW)   &trans      &lt 6 ENTER    &JRAticketSmartsheet1  &JRAticketSmartsheet2                    &pcpass            &kp LS(INTERNATIONAL_1)
            >;

            sensor-bindings = <&inc_dec_kp LC(PAGE_UP) LC(PAGE_DOWN)>;
        };

        MOUSE {
            bindings = <
&trans  &trans  &trans  &trans  &trans            &trans  &trans    &trans  &trans    &trans
&trans  &trans  &trans  &trans  &trans            &trans  &mkp MB1  &mo 5   &mkp MB2  &trans
&trans  &trans  &trans  &trans  &trans            &trans  &trans    &trans  &trans    &mkp MB3
&trans  &trans  &trans  &trans  &trans  &trans    &trans  &trans            &trans    &trans
            >;
        };

        SCROLL {
            bindings = <
&trans  &trans  &none   &trans  &trans            &none   &none   &trans  &trans  &none
&none   &trans  &trans  &trans  &trans            &none   &none   &none   &trans  &trans
&trans  &trans  &trans  &trans  &trans            &trans  &trans  &trans  &trans  &trans
&trans  &trans  &trans  &trans  &trans  &trans    &trans  &trans          &trans  &trans
            >;
        };

        FUNCTION {
            bindings = <
&kp F1                &kp F2                &kp F3           &kp F4  &kp F5            &kp F6     &kp F7     &kp F8            &kp F9             &kp F10
&kp LS(LG(NUMBER_3))  &kp LS(LG(NUMBER_4))  &kp LS(LG(N5))   &trans  &trans            &kp MINUS  &kp EQUAL  &kp LEFT_BRACKET  &kp RIGHT_BRACKET  &kp NON_US_BACKSLASH
&trans                &trans                &trans           &trans  &trans            &trans     &trans     &kp SEMICOLON     &kp SINGLE_QUOTE   &kp GRAVE
&kp K_MUTE            &kp C_VOLUME_DOWN     &kp C_VOLUME_UP  &trans  &trans  &trans    &trans     &trans                       &trans             &kp LS(INT1)
            >;
        };

        Bluetooth {
            bindings = <
&trans  &trans  &trans  &trans  &trans            &bt BT_SEL 0   &bt BT_SEL 1   &bt BT_SEL 2   &bt BT_SEL 3   &trans
&trans  &trans  &trans  &trans  &trans            &to 1          &to 0          &trans         &trans         &trans
&trans  &trans  &trans  &trans  &trans            &bt BT_DISC 0  &bt BT_DISC 1  &bt BT_DISC 2  &bt BT_DISC 3  &bt BT_CLR
&trans  &trans  &trans  &trans  &trans  &trans    &trans         &bootloader                   &trans         &bt BT_CLR_ALL
            >;
        };

        Mac_ARROW {
            bindings = <
&kp LS(NUMBER_1)        &kp LS(NUMBER_2)      &kp LS(NUMBER_3)         &kp LS(NUMBER_4)        &kp LS(N5)                   &kp LS(NUMBER_6)       &kp LS(N7)             &kp LS(N8)        &kp LS(N9)         &kp LS(N0)
&kp SEMICOLON           &kp LG(LEFT_ARROW)    &kp UP_ARROW             &kp LG(RIGHT_ARROW)     &macpass                     &kp MINUS              &kp EQUAL              &kp LEFT_BRACKET  &kp RIGHT_BRACKET  &kp BACKSLASH
&kp LS(SEMICOLON)       &kp LEFT_ARROW        &kp DOWN_ARROW           &kp RIGHT_ARROW         &onepassword                 &kp LS(MINUS)          &kp LS(EQUAL)          &kp LEFT_BRACE    &kp RIGHT_BRACE    &kp LS(BACKSLASH)
&kp LG(LA(LEFT_ARROW))  &kp LG(LA(UP_ARROW))  &kp LG(LA(RIGHT_ARROW))  &kp LG(LA(DOWN_ARROW))  &trans        &lt 6 ENTER    &JRAticketSmartsheet1  &JRAticketSmartsheet2                    &onepassword       &kp UNDERSCORE
            >;

            sensor-bindings = <&inc_dec_kp LC(PAGE_UP) LC(PAGE_DOWN)>;
        };

        layer_9 {
            bindings = <
&trans  &trans  &trans  &trans  &trans            &trans  &trans  &trans  &trans  &trans
&trans  &trans  &trans  &trans  &trans            &trans  &trans  &trans  &trans  &trans
&trans  &trans  &trans  &trans  &trans            &trans  &trans  &trans  &trans  &trans
&trans  &trans  &trans  &trans  &trans  &trans    &trans  &trans          &trans  &trans
            >;
        };
    };
};
